URL de autenticação -> protocolo OAuth 2.0

CLIENT_ID = os.getenv("STRAVA_CLIENT_ID")
CLIENT_SECRET = os.getenv("STRAVA_CLIENT_SECRET")
REDIRECT_URI = os.getenv("STRAVA_REDIRECT_URI")

AUTH_URL = "https://www.strava.com/oauth/authorize"
TOKEN_URL = "https://www.strava.com/oauth/token"

def authorize():
    url = (
        f"{AUTH_URL}" -> endereço do servidor de autorização

        f"?client_id = {CLIENT_ID}" -> id do app

        f"&response_type = code" -> quando o usuario autorizar, é enviado um codigo de autorização temporario, mais tarde esse é código vai ser trocado por um token definitivo

        f"&redirect_uri = {REDIRECT_URI}" -> endereço de retorno

        f"&approval_prompt = force" -> define o comportamento da tela de permissão; force -> obriga o usuário a ver a tela de "aceito/nao aceito" toda vez; auto -> se o usuário já autorizou uma vez, sistema pula a tela

        f"&scope = activity:read_all" -> define o nível de acesso
    )

    resumo do fluxo de dados: código monta o link -> usuário clica e vai para a pagina do serviço -> usuário loga e autoriza -> serviço devolve o usuário para a REDIRECT_URI trazendo o "code" junto
    
    print("opening browser for authorization")
    webbrowser.open(url)

    =====================================

    def exchange_code_for_token(code):
    payload = {
        "client_id": CLIENT_ID,
        "client_secret": CLIENT_SECRET,
        "code": code,
        "grant_type": "authorization_code",
    }
    
    response = requests.post(TOKEN_URL, data = payload) -> faz uma requisição "escondida" para o servidor

    response.raise_for_status() -> segurança, caso o servidor tenha retornado um erro, execução é interrompida

    return response.json() -> retorna pacote de dados (JSON) contendo access_token, refresh_token e expires_at, que é quando essa chave para de funcionar